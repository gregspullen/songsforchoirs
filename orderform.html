<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Order Form ‚Äî Songs for Choirs</title>
  <meta name="description" content="Licensed choral scores ‚Äî secure order form for choirs." />
  <meta name="theme-color" content="#ffffff" />
  <link rel="icon" href="images/favicon.png" sizes="32x32" type="image/png">
  <link rel="icon" href="images/favicon.ico" type="image/x-icon">
  <link rel="shortcut icon" href="images/favicon.ico" type="image/x-icon">

  <!-- your main site stylesheet with cache-buster -->
  <link rel="stylesheet" href="styles.css?v=999css">

  <!-- Privacy-friendly analytics by Plausible -->
  <script async src="https://plausible.io/js/pa-HBU4032UPKdJXI_GDnbzu.js"></script>
  <script>
    window.plausible = window.plausible || function(){(plausible.q = plausible.q || []).push(arguments)};
    plausible.init = plausible.init || function(i){plausible.o = i || {}};
    plausible.init();
  </script>
</head>


<body class="order-page">
  <div id="wrapper">
    <header class="site-header">
      <h1 class="site-logo">
        songs<span class="gold">for</span>choirs
      </h1>
      <p class="tagline">Secure licensed downloads ‚Äî trusted by choirs.</p>
    
      <nav class="site-nav">
        <ul>
          <li><a href="index.html">Home</a></li>
          <li><a href="choral.html">Choral</a></li>
          <li><a href="children.html">Children</a></li>
          <li><a href="other.html">Other</a></li>
          <li><a href="contact.html">Contact</a></li>
        </ul>
      </nav>
    </header>
    

    <style>
    /* === Order Form Page === */

    body.order-page {
      background: linear-gradient(#f7f3eb, #f5f2ea);
      font-family: "Georgia", serif;
      color: #222;
    }

    body.order-page #content {
      max-width: 680px;
      margin: 3em auto 5em auto;
      padding: 0 1.5em;
    }

    body.order-page .panel {
      background: #fefcf8;
      border-radius: 14px;
      box-shadow: 0 2px 10px rgba(0,0,0,0.08);
      padding: 2.5em 2em 2em 2em;
      line-height: 1.6;
    }

    body.order-page h2 {
      font-size: 1.5em;
      margin-top: 0;
      text-align: left;
      color: #333;
    }

    body.order-page label {
      display: block;
      font-weight: bold;
      margin-top: 1.2em;
      margin-bottom: 0.3em;
    }

    body.order-page input[type="text"],
    body.order-page input[type="email"],
    body.order-page input[type="number"] {
      width: 100%;
      padding: 0.5em 0.6em;
      border: 1px solid #ccc;
      border-radius: 5px;
      font-size: 1em;
      box-sizing: border-box;
    }

    body.order-page input[type="text"]:focus,
    body.order-page input[type="email"]:focus,
    body.order-page input[type="number"]:focus {
      border-color: #c9a227;
      outline: none;
    }

    body.order-page .form-row {
      display: flex;
      justify-content: space-between;
      gap: 1em;
    }

    body.order-page .form-row .half {
      flex: 1;
    }

    body.order-page .note {
      font-style: italic;
      font-size: 0.9em;
      color: #7a6c58;
      margin: 1em 0 0.5em;
    }

    body.order-page button[type="submit"] {
      margin-top: 1.8em;
      background: linear-gradient(#d9b76a, #c9a227);
      border: none;
      color: #fff;
      padding: 0.8em 1.4em;
      border-radius: 6px;
      font-weight: bold;
      cursor: pointer;
      font-size: 1em;
      transition: background 0.3s ease;
    }

    body.order-page button[type="submit"]:hover {
      background: linear-gradient(#e1c983, #d1b84a);
    }
    </style>

    <main id="content">
      <div class="panel">
        <h2>Place Your Order Here</h2>

        <form action="https://www.sandbox.paypal.com/cgi-bin/webscr" method="post" id="orderForm">
          <input type="hidden" name="cmd" value="_xclick">
          <input type="hidden" name="business" value="sb-6bkuc46652199@business.example.com">
          <input type="hidden" name="currency_code" value="GBP">
          <input type="hidden" name="item_name" id="paypalItemName" value="">
          <input type="hidden" name="amount" id="paypalAmount" value="">
          <input type="hidden" name="return" id="paypalReturn" value="https://www.songsforchoirs.com/receipt.html">
          <input type="hidden" name="cancel_return" value="https://www.songsforchoirs.com/orderform.html">

          <label for="title">Title of piece:</label>
          <input id="title" required placeholder="e.g. The Lord Is My Shepherd">

          <div class="form-row">
            <div class="half">
              <label for="choir">Organisation / Choir:</label>
              <input id="choir" class="choir-field" required>
            </div>

            <div class="half">
              <label for="copy">Number of copies:</label>
              <input id="copy" class="inline-input" required type="number" min="1" max="30">
            </div>
          </div>

          <p class="note">
            Please place large orders in batches of no more than 30 copies each.<br>
            This limit applies to keep transactions and downloads safe and reliable.
          </p>

          <label for="email">Email:</label>
          <input id="email" type="email" name="email" autocomplete="email" required>
          <small>We‚Äôll only use this address to send your licensed score ‚Äî it won‚Äôt be shared with anyone else.</small>

          <label for="confirm_email" style="margin-top: 0.6em;">Confirm your email address:</label>
          <input id="confirm_email" type="email" name="confirm_email" autocomplete="email" required>

          <button type="submit">Submit Order & Continue to PayPal</button>
        </form>
      </div>
    </main>

    <footer id="site-footer">
      <p>¬© 2025 <a href="https://www.songsforchoirs.com">songsforchoirs.com</a></p>
    </footer>
  </div><!-- end wrapper -->

  <script>
  document.addEventListener("DOMContentLoaded", () => {
    // üê∏ Auto-fill the title field from URL if present
    const params = new URLSearchParams(window.location.search);
    const pieceTitle = params.get("title");
    if (pieceTitle) {
      const titleField = document.getElementById("title");
      if (titleField) {
        titleField.value = decodeURIComponent(pieceTitle);
        console.log("üê∏ Auto-filled title:", pieceTitle);
      }
    }
  });

    const form = document.getElementById("orderForm");
    const submitBtn = form.querySelector("button[type='submit']");
    const email1 = document.getElementById("email");
    const email2 = document.getElementById("confirm_email");

    form.addEventListener("submit", function (event) {
      event.preventDefault();

      const e1 = email1.value.trim();
      const e2 = email2.value.trim();
      const validFormat = /^[^@\s]+@[^@\s]+\.[^@\s]+$/;

      if (!validFormat.test(e1) || !validFormat.test(e2)) {
        alert("Please enter a valid email address.");
        return;
      }

      if (e1 !== e2) {
        alert("Email addresses don't match ‚Äî please double-check.");
        return;
      }

      // Fill PayPal fields
      document.getElementById("paypalItemName").value = document.getElementById("title").value;
      document.getElementById("paypalAmount").value = "5.00";
      const baseReturn = "https://www.songsforchoirs.com/receipt.html";
      const returnParams = new URLSearchParams({
        title: document.getElementById("title").value,
        choir: document.getElementById("choir").value,
        email: e1,
        copies: document.getElementById("copy").value
      });
      document.getElementById("paypalReturn").value = baseReturn + "?" + returnParams.toString();

      // Visual feedback
      submitBtn.disabled = true;
      submitBtn.textContent = "Processing your order... please wait";
      submitBtn.style.opacity = "0.8";
      submitBtn.style.cursor = "wait";

      setTimeout(function () {
        submitBtn.disabled = false;
        submitBtn.textContent = "Submit Order & Continue to PayPal";
        submitBtn.style.opacity = "1";
        submitBtn.style.cursor = "pointer";
      }, 10000);

      // --- Send email data to Worker in background ---
try {
  const payload = {
    title: document.getElementById("title").value,
    choir: document.getElementById("choir").value,
    copies: document.getElementById("copy").value,
    email: email1.value.trim(),
    amount: document.getElementById("paypalAmount").value
  };
  fetch("https://sfc-watermark-worker.lyra-6b2.workers.dev/send-email", {
    method: "POST",
    headers: { "Content-Type": "application/json" },
    body: JSON.stringify(payload)
  });
  console.log("üê∏ Sent order details to Worker:", payload);
} catch (err) {
  console.error("üê∏ Worker send failed:", err);
}

      form.submit();
    });
  });
  </script>
</body>
</html>
